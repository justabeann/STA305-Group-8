---
title: "STA305 Technical Report"
author: "Group 8"
date: "16/08/2021"
output:
  pdf_document:
    latex_engine: xelatex
---
\fontfamily{Arial}
\fontsize{10}{22}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(BDEsize)
```

## Objective (Question of Interest)
* Which kernel type yields the most popcorn controlling the oil type?
* Which oil type yields the most popcorn controlling the kernel type?
* Does the yield of popcorn by kernel type vary depending on the oil used?

## Variables
Predictor variables:
  Kernel type : Baby white (A), Ladyfinger (B), Medium White (C), Midnight blue (D)
  Oil type: Canola oil (1), Sunflower (2), Safflower oil (3)
Response variable:
  Yield of popcorn kernels (measured by number of popped kernels)
Blocking variable: Pot size (small, medium, large)

#### Load the data
```{r}
pop_data <- read_excel("STA305_FinalProjectData.xlsx")
attach(pop_data)

table(OIL,KERNEL)
```
Every treatment combination is possible, there are 9 observations in each treatment level, so this is a completed and balanced design, with crossed factor.


# Sample Size Calculations

For the sample size calculations, we will set the probability of a type I error to be 5%, i.e., $P(\text{reject } H_0 \mid H_0 \text{ is true}) = 0.05$. As for the power, we will set the power to be the standard 80% which is to say that the probability of a type II error is set at 20%, i.e., $P(\text{fail to reject } H_0 \mid H_0 \text{ is false}) = 0.05$. Furthermore, detecting small effects requires larger sample sizes. Hence, given the time limitations of the experiment, we will consider detecting only large effects to be suffficient. Given these parameters, the sample size calculations are done in the code below. The minimum sample size required for our RCBD with an interaction term is three batches of popcorn per treatment, per block. In this case, the exact effect sizes are 0.68 for the oil type, 0.69 for the kernel type, and 0.998 for the interaction term. As per Cohen, this corresponds to a medium-large effect for the factors of interest (oil type and kernel type)and a (very) large effect for the interaction term. If interactions are removed from the model, the minimum sample size is reduced to two batches per treatment, per block. In this case, the effect sizes are 0.85 for oil type and 0.87 for the kernel type. Given these results, we will go with a sample size of three batches of popcorn per treatment, per block. Since the oil type factor has three levels and the kernel type factor has four levels, there are 12 treatments. Since each block will get all treatments (and there are three blocks), the total sample size is 108 batches of popcorn (12 treatments times three blocks times three batches per group).

```{r}
# With interaction
Size.Block(factor.lev=c(3, 4), interaction=TRUE, delta_type=1, delta=c(1, 1, 1), alpha=0.05, beta=0.2)
# Without interaction
Size.Block(factor.lev=c(3, 4), interaction=FALSE, delta_type=1, delta=c(1, 1, 1), alpha=0.05, beta=0.2)
```

# Model 1: Interaction and main effect model
  $y_{i} = \beta_{0}+\beta_{1}*I_{B,i}+\beta_{2}*I_{C,i} + \beta_{3}*I_{D,i}$
  $+ \beta_{4}*I_{2,i} + \beta_{5}*I_{3,i} + \beta_{6}*[I_{B,i}*I_{2,i}]$
  $+ \beta_{7}*[I_{C,i}*I_{2,i}] + \beta_{8}*[I_{D,i}*I_{2,i}] +$
  $\beta_{9}*[I_{B,i}*I_{3,i}] + \beta_{10}*[I_{C,i}*I_{3,i}] +$
  $\beta_{11}*[I_{D,i}*I_{3,i}] + e_{i}$

## Hypothesis:
  $H_{0}:\beta_{5}=\beta_{6}=\beta_{7}=\beta_{8}=\beta_{9}=\beta_{10}=\beta_{11}=0$
  
  $H_{a}:\ at\ least\ one\ \beta_{k} \ne 0,\ for\ k=5,6,...,11$
 
```{r}
model_1 <- lm(NUM_POPPED~POT+KERNEL*OIL)
anova(model_1)
```
## Test Statistic
$F= MSab/MSE = 1.0199$~$F_{6,94}$
$p= P (F_{6,94}>F)=0.4173 > 0.05$

## Conclusion
Therefore, there is insufficient evidence that popcorn yield by kernel types vary depending on the type of oil used when making popcorn. Since interaction was not statistically significant, we will need to fit an additive model.

# Model 2: Additive model
  $y_{i} = \beta_{0}+\beta_{1}*I_{B,i}+\beta_{2}*I_{C,i} + \beta_{3}*I_{D,i}$
  $+ \beta_{4}*I_{2,i} + \beta_{5}*I_{3,i} + e_{i}$

## Hypothesis for Kernel Type
$H_{0}:\beta_{1}=\beta_{2}=\beta_{3}=0$
  
$H_{a}:\ at\ least\ one\ \beta_{k} \ne 0,\ for\ k=1,2,3$

## Hypothesis for Oil Type
$H_{0}:\beta_{4}=\beta_{5}=0$
  
$H_{a}:\ at\ least\ one\ \beta_{k} \ne 0,\ for\ k=4,5$

```{r}
model_2 <- lm(NUM_POPPED~POT + KERNEL+OIL)
anova(model_2)
```
## Test Statistic

### Kernel Effect
$F= MSkernel/MSE = 18.9818$~$F_{3,100}$
$p= P (F_{3,100}>F)= 8.058e-10 < 0.05$
  
### Oil effect
$F= MSoil/MSE = 1.110075$~$F_{2,100}$
$p= P (F_{2,100}>F)= 0.3336> 0.05$



## Conclusion
### Kernel Effect
### Oil effect


# Checking necessary assumptions
* Normality of the observations (e.g. QQ plot ) 
* Independence of treatments (checked by the nature of our design)
* Homogeneity within blocks (checked by the nature of our design)
* Heterogeneity between blocks  (checked by the nature of our design)
* Homogeneity of variance between treatment (e.g. residual versus fit plot) 

```{r}
par(mfrow=c(2,2))

plot(model_1, 2) #normality of model 1
plot(model_2, 2) #normality of model 2

plot(model_1,1) #homogeneity of variance model 1
plot(model_2,1) #homogeneity of variance model 2
```



# Conclusion
